将 **HTML 文本**解析成 **DOM 树**（Document Object Model）是浏览器内核工作流程中的第一步，也是至关重要的一步。==这个过程非常系统化，可以分解为以下几个关键阶段：==

## HTML 解析成 DOM 树的原理

HTML 解析器（Parser）的主要目标是将接收到的原始 HTML 字节流转换成一个具有层级结构的、可编程访问的对象模型——**DOM 树**。

### 1. 字节到字符 (Bytes to Characters)

这是解析过程的起点。

- **输入：** 浏览器从网络或本地文件中接收到 HTML 文件的原始**字节（Bytes）**。
    
- **解码：** 浏览器根据文件指定的编码（如 UTF-8）将这些字节解码成单个**字符**。
    

### 2. 字符到令牌 (Characters to Tokens)

这一阶段将连续的字符流转换成有意义的结构单元——**令牌（Tokens）**。

- **分词器（Tokenizer）：** ==字符流进入分词器。分词器根据 HTML 规范，识别出不同类型的令牌，例如：==
    
    - **起始标签令牌**（如 `<p>`, `<div>`）
        
    - **结束标签令牌**（如 `</p>`, `</div>`）
        
    - **属性令牌**（如 `class="example"`）
        
    - **文本令牌**（标签之间的实际内容）
        
    - **注释令牌**（如 ``）
        
- **状态机：** 分词器通常是一个状态机，它根据当前读取的字符和所处的状态来决定如何处理下一个字符，并生成相应的令牌。
    

### 3. 令牌到节点 (Tokens to Nodes)

这是构建树形结构的核心阶段。

- **树构建器（Tree Constructor）：** 令牌流进入树构建器。树构建器会根据令牌的类型，创建相应的 **DOM 节点**，并将它们按照父子关系组织起来。
    
- **创建元素和文本节点：**
    
    - 当树构建器接收到一个**起始标签令牌**时（如 `<div>`），它会创建一个新的 **元素节点**，并将其添加到 DOM 树中当前节点的子节点列表中。
        
    - 当接收到**文本令牌**时，它会创建一个 **文本节点**，作为当前元素的子节点。
        
    - 当接收到**结束标签令牌**时（如 `</div>`），树构建器就知道当前元素及其所有子元素都已经处理完毕，会将当前节点指针上移到父节点。