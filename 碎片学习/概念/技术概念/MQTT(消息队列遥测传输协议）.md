==MQTT（Message Queuing Telemetry Transport，消息队列遥测传输协议），是一种基于发布/订阅（publish/subscribe）模式的"轻量级"通讯协议==，该协议构建于TCP/IP协议上，由IBM在1999年发布。MQTT最大优点在于，可以以极少的代码和有限的带宽，为连接远程设备提供实时可靠的消息服务。作为一种低开销、低带宽占用的即时通讯协议，使其在物联网、小型设备、移动应用等方面有较广泛的应用。

MQTT是一个基于客户端-服务器的消息发布/订阅传输协议。MQTT协议是轻量、简单、开放和易于实现的，这些特点使它适用范围非常广泛。在很多情况下，包括受限的环境中，如：机器与机器（M2M）通信和物联网（IoT）。==其在，通过卫星链路通信传感器、偶尔拨号的医疗设备、智能家居、及一些小型化设备中已广泛使用。==

## 优势

### **轻量、高效**

IoT 设备上的 MQTT 实施需要最少的资源，因此它甚至可以用于小型微控制器。==例如，最小的 MQTT 控制消息可以少至两个数据字节==。MQTT 消息的标头也很小，因此您可以优化网络带宽。

### **可扩展**

MQTT 实施需要最少的代码，在操作中消耗的功率非常少。==该协议还具有支持与大量物联网设备通信的内置功能。==因此，您可以实施 MQTT 协议来连接数百万台此类设备。

### **可靠**

许多 IoT 设备通过低带宽、高延迟的不可靠蜂窝网络连接。MQTT 具有内置功能，可减少 IoT 设备重新连接云所需的时间。它还定义了三种不同的服务质量级别，以确保 IoT 用例的可靠性——最多一次（0）、至少一次（1）和恰好一次（2）。

### **安全**

==MQTT 使开发人员可以轻松地使用现代身份验证协议（例如 OAuth、TLS1.3、客户管理的证书等）加密消息并对设备和用户进行身份验证。==

### **得到良好的支持**

几种语言（如 Python）对 MQTT 协议的实施提供广泛的支持。因此，开发人员可以在任何类型的应用程序中以最少的编码快速实现它。

## 原理

MQTT 协议基于发布/订阅模型工作。==在传统的网络通信中，客户端和服务器直接相互通信。客户端向服务器请求资源或数据，然后，服务器将处理并发回响应==。但是，MQTT 使用发布/订阅模式将消息发送者（发布者）与消息接收者（订阅者）解耦。相反，==称为消息代理的第三个组件将处理发布者和订阅者之间的通信。代理的工作是筛选所有来自发布者的传入消息，并将它们正确地分发给订阅者。==代理将发布者和订阅者解耦，如下所示：

#### ****_空间解耦_****
发布者和订阅者不知道彼此的网络位置，也不交换 IP 地址或端口号等信息。

#### ****_时间解耦_****
发布者和订阅者不会同时运行或具有网络连接。

#### ****_同步解耦_****
发布者和订阅者都可以发送或接收消息，而不会互相干扰。例如，订阅者不必等待发布者发送消息。

## MQTT 有哪些组成部分

MQTT 通过如下定义客户端和代理来实施发布/订阅模型。

### **MQTT 客户端**

MQTT 客户端是从服务器到运行 MQTT 库的微控制器的任何设备。如果客户端正在发送消息，它将充当发布者；如果它正在接收消息，它将充当接收者。==基本上，任何通过网络使用 MQTT 进行通信的设备都可以称为 MQTT 客户端设备==。

### **MQTT 代理**

==MQTT 代理是协调不同客户端之间消息的后端系统。代理的职责包括接收和筛选消息、识别订阅每条消息的客户端，以及向他们发送消息。==它还负责其他任务，例如：

- 授权 MQTT 客户端以及对其进行身份验证
- 将消息传递给其他系统以进行进一步分析
- 处理错过的消息和客户端会话

### **MQTT 连接**

==客户端和代理开始使用 MQTT 连接进行通信。客户端通过向 MQTT 代理发送 _CONNECT_ 消息来启动连接==。代理通过响应 _CONNACK_ 消息来确认已建立连接。MQTT 客户端和代理都需要 TCP/IP 堆栈进行通信。客户端从不相互联系，它们只与代理联系。

### **MQTT 主题**

“主题”一词是指 MQTT 代理用于为 MQTT 客户端筛选消息的关键字。主题是分层组织的，类似于文件或文件夹目录。例如，考虑在多层房屋中运行的智能家居系统，每层都有不同的智能设备。在这种情况下，MQTT 代理可以将主题组织为：

_ourhome/groundfloor/livingroom/light_

_ourhome/firstfloor/kitchen/temperature_

### **MQTT publish**

MQTT 客户端以字节格式发布包含主题和数据的消息。客户端确定数据格式，例如文本数据、二进制数据、XML 或 JSON 文件。例如，智能家居系统中的灯可能会针对主题 _livingroom/light_ 发布消息 _on_。

### **MQTT subscribe** 

MQTT 客户端向 MQTT 代理发送 _SUBSCRIBE_ 消息，以接收有关感兴趣主题的消息。此消息包含唯一标识符和订阅列表。例如，您手机上的智能家居应用程序想要显示您家中有多少灯亮着。它将订阅主题 _light_ 并增加所有 _on_ 消息的计数器。

## 什么是 MQTT over WSS？

MQTT over WebSockets (WSS) 是一种 MQTT 实施，用于将数据直接接收到 Web 浏览器中。MQTT 协议定义了一个 JavaScript 客户端来为浏览器提供 WSS 支持。在这种情况下，该协议照常工作，但它向 MQTT 消息添加了额外标头以支持 WSS 协议。您可以将其视为包装在 WSS 信封中的 MQTT 消息负载。