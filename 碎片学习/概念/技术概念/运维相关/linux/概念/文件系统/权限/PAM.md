PAM 是 Pluggable Authentication Modules（可插入认证模块）的缩写。

它在 Linux 和其他类 Unix 系统中是一==个**统一的、模块化的认证框架**，主要用于管理系统上用户的**身份验证 (Authentication)**、**授权 (Authorization)**、**账户管理 (Account Management)** 和**会话管理 (Session Management)**。==

### PAM 解决的问题

在 PAM 出现之前，系统上的每个需要认证的应用程序（比如登录程序 `login`、SSH 服务 `sshd`、修改密码程序 `passwd`、切换用户程序 `su`、执行特权命令程序 `sudo` 等）都需要自己实现一套认证逻辑。这意味着：

1. **代码冗余**：不同的应用程序会重复编写相似的认证代码。
    
2. **维护困难**：==如果认证方式需要改变（例如，从使用本地密码改为使用 LDAP、Kerberos、指纹识别或其他任何认证机制），所有相关的应用程序都需要被修改和重新编译。==
    
3. **缺乏灵活性**：很难集成新的认证方法或安全策略。
    

PAM 就是为了解决这些痛点而诞生的。

### PAM 的核心思想

==PAM 的核心思想是**将认证逻辑与应用程序本身解耦**。==

- **应用程序**不再直接处理认证细节，==它们只负责调用 PAM 提供的标准接口。==
    
- **PAM 框架**根据配置文件来动态加载并执行相应的**认证模块**。
    

这样，应用程序就无需关心底层是如何进行身份验证的，它只知道用户是否通过了认证。而系统管理员可以根据需要，通过修改 PAM 配置文件来改变认证策略，而无需触碰应用程序的代码。

### PAM 的主要组件

1. **应用程序 (Applications)**：
    
    - 例如 `login`、`sshd`、`sudo`、`passwd`、`su` 等。
        
    - 它们作为 PAM 的“客户端”，通过 PAM 库进行认证请求。
        
2. **PAM 库 (PAM Library - `libpam.so`)**：
    
    - 这是 PAM 框架的核心。它提供了一组 API 供应用程序调用。
        
    - 当应用程序调用 PAM API 时，==PAM 库会读取对应的 PAM 配置文件，并根据配置加载和执行相应的 PAM 模块。==
        
3. **PAM 配置文件 (`/etc/pam.d/`)**：
    
    - 这个目录下存放着一系列配置文件，每个文件通常对应一个需要进行 PAM 认证的应用程序（例如 `/etc/pam.d/login`、`/etc/pam.d/sshd`）。
        
    - 这些文件定义了针对特定应用程序的认证策略，包括要使用哪些模块、==这些模块的执行顺序以及它们的执行结果如何影响最终的认证决策。==
        
4. **PAM 模块 (PAM Modules)**：
    
    - 实际执行认证、授权、账户和会话管理任务的代码块。它们是动态链接库文件（通常以 `.so` 结尾），位于 `/lib/security/` 或 `/lib64/security/` 目录下。
        
    - 每个模块专注于一个特定的功能，例如：
        
        - `pam_unix.so`：处理基于 `/etc/passwd` 和 `/etc/shadow` 的传统 Unix 用户密码认证。
            
        - `pam_pwquality.so`：强制执行密码复杂度规则（如长度、大小写、特殊字符）。
            
        - `pam_ldap.so`：通过 LDAP 服务器进行用户认证。
            
        - `pam_faillock.so`：记录用户登录失败次数，并在达到一定次数后锁定账户。
            
        - `pam_limits.so`：设置用户进程的资源限制（例如最大文件打开数、最大内存使用）。
            
        - `pam_systemd.so`：与 systemd 集成，管理用户会话和相关的 cgroup。

### PAM 的优势总结

- **高度模块化和可插拔**：==可以根据需求轻松地更换或添加认证机制。==
    
- **集中式策略管理**：所有认证策略都集中在 PAM 配置文件中，易于管理和审计。
    
- **增强安全性**：通过多重认证模块的组合，可以实现更复杂的安全策略。
    
- **简化应用程序开发**：==应用程序无需关注认证细节，只需调用 PAM 接口。==
    
- **支持多种认证技术**：轻松集成本地密码、LDAP、Kerberos、Radius、生物识别等多种认证方式。