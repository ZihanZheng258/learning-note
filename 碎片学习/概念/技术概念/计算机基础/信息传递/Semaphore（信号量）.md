Semaphore（信号量）是一种在并发编程中用于**控制对共享资源的访问数量**的同步机制。你可以把它想象成一个拥有固定数量许可证的看门人。

### 核心思想

- **许可证（Permits）**：Semaphore 内部有一个计数器，代表可用的许可证数量。
    
- **获取（Acquire）**：当一个线程想要访问共享资源时，==它需要向 Semaphore 申请一个许可证。==
    
    - 如果有可用的许可证，线程就会获取一个，计数器减 1，然后继续执行。
        
    - 如果没有可用的许可证，线程就会被阻塞，直到有其他线程释放许可证。
        
- **释放（Release）**：当一个线程使用完资源后，它会释放一个许可证，计数器加 1。

### 经典例子：停车场

你可以用一个停车场来类比 Semaphore：

- **停车场**：共享资源，但车位有限。
    
- **车位数量**：Semaphore 的许可证数量。
    
- **车**：想要进入的线程。
    
- **入口**：`acquire()` 方法。
    
- **出口**：`release()` 方法。
    

假设停车场有 10 个车位（Semaphore 的许可证数量为 10）。

1. 当第 1-10 辆车进入时，每辆车都会成功获取一个许可证，许可证数量递减。
    
2. 当第 11 辆车想要进入时，发现没有空位（许可证数量为 0），它就会在入口处等待。
    
3. 当一辆车离开时，它会释放一个许可证，许可证数量加 1。
    
4. 等待的第 11 辆车会立即获取这个许可证，进入停车场。

### Semaphore 的应用场景

- **数据库连接池**：数据库连接是有限的资源。==你可以使用 Semaphore 来控制同时访问数据库的线程数量，防止连接数超过上限。==
    
- **资源下载器**：如果你需要同时下载多个文件，但又不希望占用过多带宽，可以使用 Semaphore 来限制同时进行的下载任务数量。
    
- **API 访问限流**：限制对某个 API 的并发请求数量，以保护后端服务不被过载。
    

总而言之，Semaphore 是一个灵活且强大的并发工具，它通过控制并发访问的数量，有效地管理共享资源，防止系统过载。