在计算机科学和文件系统中，==**位图 (Bitmap)** 是一种非常高效且常用的数据结构，它本质上是一个**二进制位 (bit) 的数组**==。每个位（0 或 1）代表某个资源或状态的两种可能情况。这种结构之所以强大，在于它能以极小的空间开销来管理大量的离散资源。

### 1. 位图是什么？

你可以把位图想象成一张巨大的、由无数个小方格组成的“检查表”。每个小方格代表一个特定的项，而这个小方格的状态（涂黑或留白，对应 1 或 0）则表示该项是否被占用或处于某种状态。

- **基本原理：** 最小的存储单位是字节 (byte)，一个字节有 8 位 (bit)。位图就是利用这些位来存储信息。
- **如何表示：**
    - **`1` (或设置位)：** 通常表示资源已被占用、已分配、可用、真 (true) 等。
    - **`0` (或清除位)：** 通常表示资源空闲、未分配、不可用、假 (false) 等。

### 2. 位图在文件系统中的应用：空闲块位图 (Free Block Bitmap) 和 Inode 位图 (Inode Bitmap)

位图在文件系统中发挥着核心作用，尤其是在管理磁盘上的存储空间和 inode 资源方面。

#### a. 空闲块位图 (Free Block Bitmap)

- **作用：** 文件系统使用空闲块位图来追踪磁盘上哪些数据块是**空闲的**，哪些是**已被占用的**。
- **原理：**
    - ==文件系统中的每个数据块（通常为 1KB、2KB 或 4KB 大小）都在空闲块位图中对应一个特定的位==。
    - 如果某个数据块被文件占用，其对应的位就设置为 `1`。
    - 如果某个数据块是空闲的，其对应的位就设置为 `0`。
- **如何工作：**
    - **分配数据块：** ==当你需要创建一个新文件或扩大一个文件时，文件系统会在空闲块位图中查找第一个或最优的 `0` 位，找到后将其设置为 `1`==，并将对应的数据块分配给文件。
    - **释放数据块：** 当文件被删除或缩小，其占用的数据块被释放时，文件系统会将这些数据块在位图中对应的位设置为 `0`，表示它们现在可以被重新使用了。
- **优点：**
    - **高效查找：** 查找空闲块非常快，只需扫描位图即可。
    - **空间效率：** 1 个字节可以管理 8 个数据块的状态。对于一个 1TB 的硬盘，如果块大小是 4KB，那么总共有 1TB/4KB=240/212=228 个数据块。需要 228 位来管理，即 228/8=225 字节 = 32 MB 的位图空间，这对于管理如此巨大的磁盘空间来说是相当高效的。

#### b. Inode 位图 (Inode Bitmap)

- **作用：** 类似于空闲块位图，==Inode 位图用于追踪文件系统中哪些 **inode** 是**空闲的**，哪些是**已被占用的**==。
- **原理：**
    - 文件系统中的每个 inode（唯一的编号）都在 Inode 位图中对应一个特定的位。
    - 如果某个 inode 被文件或目录占用，其对应的位就设置为 `1`。
    - 如果某个 inode 是空闲的，其对应的位就设置为 `0`。
- **如何工作：**
    - **分配 Inode：** ==当你创建一个新文件或目录时，文件系统会在 Inode 位图中查找一个空闲的 `0` 位==，找到后将其设置为 `1`，并将对应的 inode 分配给新创建的文件/目录。
    - **释放 Inode：** ==当文件或目录被删除，并且其链接计数变为 0 时==，文件系统会将其 inode 在位图中对应的位设置为 `0`，表示该 inode 现在可以被重新使用了。
- **优点：**
    - **高效管理：** 快速查找和分配/释放 inode。
    - **文件数量限制：** Inode 位图的大小决定了文件系统能够支持的最大文件数量。