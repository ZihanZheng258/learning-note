现在互联网公司基本上都是快节奏的发布，我们做 App 都是先发 MVP 版本，然后再持续优化。每个迭代，产品经理都是只提几个有限的需求，开发也只开发这几个需求就上线。

然后就进入不断堆功能的小步快跑阶段，缝缝补补又一年。产品经理也会用各种方式尝试去识别功能的收益，埋点、报表、同比环比等等。

**说了这么多瀑布流和敏捷，这和代码不可避免的腐化有什么关系呢？**

其实当你知道我们现在这种中华田园式敏捷开发之后，你马上就能意识到，==**每次你在做技术方案设计时，你能拿到的信息仅仅是宏大视图中的小小一角，根本没有全貌，你并不能像瀑布流开发那样拿到产品的整体视图。**==

仅仅凭借这一点点信息，再牛逼的架构师设计出来的方案也总是有局限性的，这也是为什么我前面说架构设计和模块抽象只能面向当下，它天然是短视的。

==这不是人的问题，这是开发方式的问题。当然，现实情况是，这种局部的需求，很多人也没有去做设计，拿到需求做开始从 controller 开始写代码解析入参，然后 service 组合一下 RPC 和 DB 调用，DAO 再实现几个数据库查询就完事儿了==，啪的一下，很快哦。

根据我的经验，这种情况甚至能占到 80% 以上。在一个项目中只有少量的局部架构设计 + 这些架构设计还不一定合理 + 80% 以上任何设计都没有 + 有上千种让代码难以阅读的编码方式，**如果我说代码不腐化，你信吗？**

这里再举个例子。

一开始有个后台管理系统，需要做权限管理功能，所以基于业界常见的 RBAC 模型开发了一个权限管理模块。

在做方案设计时，我们一直比较关注可复用性，因为后续可能有别的系统也需要权限管理。其实办法也很简单，我们在模型中加入了租户的概念(appid)，所有的 Role 表和 Access 表都带上 appid 字段。

这样，不同业务可以自定义自己的 Role 和 Access 而不干扰其它的业务。这个设计按理说也还可以，只要是基于 RBAC 模型的权限管理，后续分配个 appid 就可以用了。

然而，两周后的一个需求直接就来打脸了。这个需求也要做权限管理，它表面上看也是基于 RBAC 模型的，但是有点细微的区别。

简单说，==这个需求类似于游戏里的帮派管理，帮主有所有权限。他还能够设置任意多个管理组，把帮派成员加入或踢出某个管理组；管理组成员可以管理帮派成员。管理组之间也有权重，权重高的管理组可以管理权重低的管理组。==

看起来依然是基于 RBAC 模型，不同管理组就是不同 Role 嘛。

但是这里最大的区别就是，原始的 RBAC，Role 之间是互相无感知的，不同 Role 不需要知道别的 Role 的存在，它只需要知道它有哪些 Access。

但是对于这个需求，Role 之间需要建立关系，有优先级，高级的 Role 可以管理低级的 Role。

这种 Role 之间的关联关系，在一开始设计 RBAC 模块时是没想到的，所以我们当时的设计只能应对当时的需求，扩展性也只是多租户，而对于新的需要修改模型的功能就无能为力了。

==这也是为什么我说在「**中华田园敏捷**」开发中，架构设计总是短视的。==

后来我们进行了一个小复盘，为什么设计的通用权限管理第一个需求就没法复用。我们为后台管理设计的模型，谁能想到产品要做帮派管理。

==**虽然我们的扩展性设计只考虑多租户也确实过于简单了，但是如果考虑更多扩展性，工时是不是也会增加呢，会不会又有过度设计的嫌疑呢**==

后来，那个业务又只能重新开发一套了，当然里面还包含很多其它性能优化，因为它们的请求量比较大，各种数据要缓存到 Redis，而我们一开始的面向后台管理系统的 RBAC，一天也没几个人用，每次都直接读的 MySQL。