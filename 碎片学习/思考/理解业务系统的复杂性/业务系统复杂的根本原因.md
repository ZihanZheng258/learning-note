结合过去参与过的很多业务系统的经验以及近期看书的一些思考，==抛开人的原因（假设人都是理智的有追求的）==，我认为导致业务系统复杂的根本原因有两个：

- 功能之间隐秘增加的耦合
    
- 不可避免的代码腐化
    
## 功能之间隐蔽增加的耦合

我相信绝大部分开发在项目一开始的时候，都有一颗「**整洁架构**」的心，都希望把代码写好。

尤其是项目一开始，需求做的飞快，每天几千行代码也不在话下。他会关注函数的颗粒度，==会关注模块的划分和职责单一，也会关注单元测试和代码的可测性。==

但即使这样，随着时间推移，他也会发现代码改起来越来越痛苦，总有牵一发而动全身，或者明明是修改功能 A，却不得不关注功能 B 是否受影响。为啥呢？

答案就是——**耦合**。很多人一说到耦合，就会面露厌恶。

确实，==很多时候不合理的耦合是万恶之源。但是耦合又是不可避免的，因为 Essential Complexity 的存在。==

如果某个功能本来就需要多个模块共同参与，不论你怎么分解这些模块，只有把他们「集成」到一起，才能实现有意义的功能。

把它们集成到一起，A 依赖于 B，B 又依赖 C，C 又会反馈给A，这不就是耦合吗？软件工程中有句话每个人都烂熟于心：

> 高内聚，低耦合

但很多人只记住了后面三个字「**低耦合**」，却忘记了前面的三个字「**高内聚**」。

在高内聚的边界之内，==各个模块之间是不是就是强耦合的呢？即使你认真的去进行架构设计和模块拆分，这种耦合也是难以避免的，我可以举一些例子来看看。==

某团队开发了一个社区类应用，社区应用大家应该也用过不少，大体架构是差不多的，一般都会包含如下一些业务模块：

- 资讯：可以简单理解为feeds流，主要以左文右图的方式来展示
    
- 社区：用户开放交流的地方，可以类比于新浪微博或者twitter，用户可以发带图片的内容
    
- 评论区：资讯、动态都可以发评论
    
- ...
    

上述这几个模块都是比较独立的业务，产品形态也有差异，因此一般都会由不同的小 Team 来负责。

有一天，产品经理希望做一个新功能，叫「名片系统」。简单来说就是，它允许用户自定义自己头像后面还可以展示哪些名片或者标签（可以有多个），以突显身份特征，比如：

![[Pasted image 20250623153514.png]]

这个需求其实初看起来也没有多复杂，闭上眼睛一琢磨大概就能想到，我们首先需要做一个配置页面让用户去选择要展示的标签并存起来，同时需要在 App 中各种需要展示头像的地方去读取用户的相关配置，好让客户端进行展示。看起来不难对吧？

但是再深入想一想，你就会发现这里其实并没有想象的那么简单。

如果没有意识到由 Essential Complexity 引入的耦合，开发者很可能在排期的时候少估算了天数，最后不得不需要用各种「责任感」、「Ownership」这种精神力量通过加班来尽量保证不 delay。

我们来看看为什么。

首先配置页面需要从不同的系统去加载用户拥有的标签。比如用户勋章，需要从成就系统去获取，诸如“连续签到30天”，“连续创作一周”之类的。

会员信息需要从会员系统获取，主要就是用户会员的 VIP 等级。个人/企业认证，类似于微博的黄 V 和蓝 V，需要从认证系统去获取...

==这里的重点不是说要去不同的系统查数据麻烦，重点是这里引入了新的耦合！==

==这些原本设计之初毫不相关的概念，被这个需求关联在一起了。这种后来的再建立关联关系，任谁在系统设计之初也不可能在架构层面去设计。==

并且，考虑到产品功能的完整性，这会带来一个问题==，就是这个需求会变得很「**长尾**」。==后续如果一个负责资讯板块的产品经理想要增强平台优质内容的丰富度，要做一个签约作者的体系。

这时他除了要让推荐系统对该签约作者发的内容在推荐上做些倾斜调整，是不是还不能忘了要到和那个需求基本上没啥关系的名片系统来做些修改，从而让这部分用户能对外展示自己是“签约作者”的标签。

==后续只要是和身份相关的内容，都会和这个功能耦合。当然，其实也可以不全支持，又不是不能用，但是这就会带来负向的用户体验。==

“我辛辛苦苦创作内容，好不容易获得了高赞作者的称号，你不让我配，能配的主要就是 VIP 这些，掉钱眼里了吧？” 如果这类负面舆论处理不及时，很可能这个需求的收益甚至不如它带来的负面影响。

==除了上述配置端，展示端其实也被耦合了。==

原本资讯的 Feed流、社区的动态列表、评论区，以及资讯详情页的作者头像展示部分的样式都是不一样的，有的只展示个名字，有的名字加头像，有的还要展示个人简介等等。

但现在它们都要额外考虑名片的展示，问题是有的场景位置不够，放不下那么多标签怎么办？哪个标签更重要，有没有权重？

并且，到底是名片系统统一来处理每个场景展示什么标签，还是各自场景自行决定，这也是个两难的选择。

如果分发逻辑做在名片系统，那每增加一个露出场景，名片系统也得跟着改。如果是不同场景各自负责，那它们除了实现自己的逻辑，还不能忘了名片系统。但不论怎么选，这里也引入了强耦合。

而且，即使这次梳理完了现有的所有场景，开发者把所有的地方都改一遍，这就完了吗？显然没有，它是一个长尾的需求。

后续只要是某个需求涉及到展示用户头像，是不是就需要考虑名片？万一这个需求开发者之前没参与过名片需求怎么办，他怎么知道要考虑名片？

免不了上线后又是一通紧急 Bugfix...很多开发怕的不是这个功能本身有多复杂，怕的就是不知道改了这里会影响别的什么地方，或者别的什么地方也需要一起改

所以你可以看到，==**当系统变得复杂，功能之间逐渐会产生耦合，它们的关联关系也会变得复杂==。**

这些无意间引入的耦合，会给后续所有的需求开发都增加一些额外的负担，==**当你在做新需求时，还必须考虑它和一些老的特性怎么融合****。**==

当系统的功能不断膨胀，这些额外负担不断增加，想让每个迭代的需求吞吐率还能保持恒定简直是痴人说梦，更别说想象中的需求交付速度越来越快了

==这些是技术架构不合理或者代码写得挫导致的吗？显然不是，这就是随着产品功能不断叠加，各种 Essential Complexity 带来的天然耦合导致的。==

到项目后期，当新增一个变更，除了修改这个变更本身，可能实际上要修改和它耦合的 n+1 的地方！！

而且你没有办法通过软件工程上的优化来消除这种复杂性，因为复杂性是不灭的，工程上的任何架构或者设计模式的引入，只会把复杂性从一个地方转移到另一个地方，但永远不会消失，**No Silver Bullet！**