在 HTTP/2 中，所有的通信都是通过一个**连接（Connection）**进行的，==这个连接内部又被划分为一个个独立的**流（Stream）**。而数据在流中传输的基本单位，就是**帧（Frame）**。==

你可以把 HTTP/2 的连接想象成一条高速公路，流是高速公路上的车道，而帧就是车道上的一辆辆小车。每一辆小车（帧）都带着特定的数据和信息，并且有自己的身份和目的地（流）。

### 帧的结构

HTTP/2 的帧有一个统一的格式，无论它是什么类型的帧，都包含以下三个基本部分：

1. **长度（Length）**：一个 24 位的字段，表示帧体的长度。这告诉接收方，这个帧有多大，方便读取。
    
2. **类型（Type）**：一个 8 位的字段，定义了帧的类型。这是帧最重要的部分，它告诉接收方应该如何解释这个帧的数据。
    
3. **标志（Flags）**：一个 8 位的字段，用于传递类型特定的控制信息。例如，==`END_STREAM` 标志表示这是流的最后一个帧，`END_HEADERS` 标志表示这是头部块的最后一个帧==。
    
4. **保留位（Reserved Bit）**：一个 1 位的保留字段，目前未被使用。
    
5. **流标识符（Stream Identifier）**：==一个 31 位的字段，用于标识帧所属的流。==这个字段是 HTTP/2 多路复用的基础，它确保了属于不同流的帧可以交错传输，但接收方可以正确地将它们重组到各自的流中。

### 常见的帧类型

HTTP/2 定义了多种帧类型，每种帧都有不同的作用，以实现协议的各种功能。以下是一些最常见的帧类型：

- **HEADERS 帧**：用于发送 HTTP 请求或响应的**头部信息**。这是 HTTP/2 头部压缩（HPACK）工作的地方。它可以包含所有的 HTTP 头部字段。
    
- **DATA 帧**：用于发送 HTTP 请求或响应的**实体内容**。例如，当你在下载一个文件时，文件的数据就是通过一个个 DATA 帧传输的。
    
- **SETTINGS 帧**：用于协商和配置连接参数。例如，客户端和服务器可以通过 SETTINGS 帧来协商最大并发流数、初始窗口大小等参数。
    
- **PRIORITY 帧**：用于指定某个流的**优先级**。这允许客户端告诉服务器，哪个流上的数据更重要，服务器可以优先发送这些数据，以优化用户体验（比如优先加载网页的 CSS 和 JS）。
    
- **RST_STREAM 帧**：用于**异常终止**一个流。例如，如果客户端发现不需要某个资源了，它可以发送一个 RST_STREAM 帧来取消正在进行的下载，从而节省资源。
    
- **GOAWAY 帧**：用于**优雅地关闭连接**。当服务器想要关闭连接时，它会发送 GOAWAY 帧，告诉客户端它将不再接受新的流，但会继续处理已经存在的流。


### 为什么使用帧？

将数据划分为帧，是 HTTP/2 相对于 HTTP/1.x 的一个巨大进步，它解决了“队头阻塞”问题，并实现了多路复用。

- **多路复用（Multiplexing）**：帧是实现多路复用的关键。由于每个帧都带有流标识符，来自不同流的帧可以在同一个 TCP 连接上交错传输。接收方会根据帧的流标识符，将它们重新组合成完整的流。
    
- **队头阻塞（Head-of-Line Blocking）的解决**：在 HTTP/1.x 中，如果一个请求的响应因为网络问题被阻塞，它会阻塞整个 TCP 连接，导致所有后续请求都无法被处理。而在 HTTP/2 中，即使一个流上的帧被阻塞，其他流上的帧仍然可以继续传输，避免了整个连接的阻塞。
    

总而言之，**帧是 HTTP/2 协议中数据传输的基本单位**。它统一了协议的格式，并使得多路复用、优先级控制等高级功能成为可能，从而显著提升了 Web 性能。