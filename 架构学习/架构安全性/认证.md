
==尽管“认证”是解决“你是谁？”的问题，但这里的“你”并不一定是指人（真不是在骂你），也可能是指外部的代码，即第三方的类库或者服务。==最初，对代码认证的重要程度甚至高于对最终用户的认证，譬如在早期的 Java 系统里，安全认证默认是特指“代码级安全”，即你是否信任要在你的电脑中运行的代码。

### HTTP 认证

前文已经提前用到了一个技术名词——认证方案（Authentication Schemes），它是指生成用户身份凭证的某种方法，这个概念最初源于 HTTP 协议的认证框架（Authentication Framework）。IETF 在[RFC 7235](https://tools.ietf.org/html/rfc7235)中定义了 HTTP 协议的通用认证框架，要求所有支持 HTTP 协议的服务器，==在未授权的用户意图访问服务端保护区域的资源时，应返回 401 Unauthorized 的状态码，同时应在响应报文头里附带以下两个分别代表网页认证和代理认证的 Header 之一，==告知客户端应该采取何种方式产生能代表访问者身份的凭证信息：

```
WWW-Authenticate: <认证方案> realm=<保护区域的描述信息>
Proxy-Authenticate: <认证方案> realm=<保护区域的描述信息>
```

HTTP 认证框架提出认证方案是希望能把认证“要产生身份凭证”的目的与“具体如何产生凭证”的实现分离开来，无论客户端通过生物信息（指纹、人脸）、用户密码、数字证书抑或其他方式来生成凭证，都属于是如何生成凭证的具体实现，都可以包容在 HTTP 协议预设的框架之内。

基于这套认证框架的思路，可以有以下认证方式:
## HTTP Basic

HTTP Basic 认证为例来介绍认证是如何工作的。HTTP Basic 认证是一种主要以演示为目的的认证方案，也应用于一些不要求安全性的场合，譬如家里的路由器登录等。Basic 认证产生用户身份凭证的方法是让用户输入用户名和密码，经过 Base64 编码“加密”后作为身份凭证。

用户在对话框中输入密码信息，譬如输入用户名`icyfenix`，密码`123456`，浏览器会将字符串`icyfenix:123456`编码为`aWN5ZmVuaXg6MTIzNDU2`，然后发送给服务端，HTTP 请求如下所示：

```
GET /admin HTTP/1.1
Authorization: Basic aWN5ZmVuaXg6MTIzNDU2
```

服务端接收到请求，解码后检查用户名和密码是否合法，如果合法就返回`/admin`的资源，否则就返回 403 Forbidden 错误，禁止下一步操作。==注意 Base64 只是一种编码方式，并非任何形式的加密，所以 Basic 认证的风险是显而易见的。==

- **Digest**：[RFC 7616](https://tools.ietf.org/html/rfc7616)==，HTTP 摘要认证，可视为 Basic 认证的改良版本，针对 Base64 明文发送的风险，Digest 认证把用户名和密码加盐（一个被称为 Nonce 的变化值作为盐值）后再通过 MD5/SHA 等哈希算法取摘要发送出去==。但是这种认证方式依然是不安全的，无论客户端使用何种加密算法加密，无论是否采用了 Nonce 这样的动态盐值去抵御重放和冒认，遇到中间人攻击时依然存在显著的安全风险。关于加解密的问题，将在“[保密](https://icyfenix.cn/architect-perspective/general-architecture/system-security/confidentiality.html)”小节中详细讨论。
- **Bearer**：[RFC 6750](https://tools.ietf.org/html/rfc6750)，基于 OAuth 2 规范来完成认证，OAuth2 是一个同时涉及认证与授权的协议，在“[授权](https://icyfenix.cn/architect-perspective/general-architecture/system-security/authorization.html)”小节将详细介绍 OAuth 2。
- **HOBA**：[RFC 7486](https://tools.ietf.org/html/rfc7486) ，HOBA（HTTP Origin-Bound Authentication）是一种基于自签名证书的认证方案。基于数字证书的信任关系主要有两类模型：一类是采用 CA（Certification Authority）层次结构的模型，由 CA 中心签发证书；另一种是以 IETF 的 Token Binding 协议为基础的 OBC（Origin Bound Certificate）自签名证书模型。在“[传输](https://icyfenix.cn/architect-perspective/general-architecture/system-security/transport-security.html)”小节将详细介绍数字证书

HTTP 认证框架中的认证方案是允许自行扩展的，并不要求一定由 RFC 规范来定义，只要用户代理（User Agent，通常是浏览器，泛指任何使用 HTTP 协议的程序）能够识别这种私有的认证方案即可。因此，很多厂商也扩展了自己的认证方案。

- **AWS4-HMAC-SHA256**：亚马逊 AWS 基于 HMAC-SHA256 哈希算法的认证。
- **NTLM** / **Negotiate**：这是微软公司 NT LAN Manager（NTLM）用到的两种认证方式。
- **Windows Live ID**：微软开发并提供的“统一登入”认证。
- **Twitter Basic**：一个不存在的网站所改良的 HTTP 基础认证。
- ……