- **准备阶段**：又叫作投票阶段，在这一阶段，==协调者询问事务的所有参与者是否准备好提交，参与者如果已经准备好提交则回复 Prepared==，否则回复 Non-Prepared。这里所说的准备操作跟人类语言中通常理解的准备并不相同，==对于数据库来说，准备操作是在重做日志中记录全部事务提交操作所要做的内容==，它与本地事务中真正提交的区别只是暂不写入最后一条 Commit Record 而已，这意味着在做完数据==持久化后并不立即释放隔离性，即仍继续持有锁，维持数据对其他非事务内观察者的隔离状态==。


- **提交阶段**：又叫作执行阶段，协调者如果在上一阶段收到所有事务参与者回复的 Prepared 消息，==则先自己在本地持久化事务状态为 Commit，在此操作完成后向所有参与者发送 Commit 指令==，所有参与者立即执行提交操作；否则，任意一个参与者回复了 Non-Prepared 消息，或任意一个参与者超时未回复==，协调者将自己的事务状态持久化为 Abort 之后，向所有参与者发送 Abort 指令，参与者立即执行回滚操作。==对于数据库来说，这个阶段的提交操作应是很轻量的，仅仅是持久化一条 Commit Record 而已，通常能够快速完成，只有收到 Abort 指令时，才需要根据回滚日志清理已提交的数据，这可能是相对重负载的操作。
- 
![[Pasted image 20250627142542.png]]